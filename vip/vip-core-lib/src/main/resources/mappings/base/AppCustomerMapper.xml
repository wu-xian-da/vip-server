<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jianfei.core.mapper.AppCustomerMapper">
	<resultMap id="BaseResultMap" type="com.jianfei.core.bean.AppCustomer">
		<id column="customer_id" property="customerId" jdbcType="VARCHAR" />
		<result column="customer_name" property="customerName"
			jdbcType="VARCHAR" />
		<result column="customer_identi" property="customerIdenti"
			jdbcType="VARCHAR" />
		<result column="customer_phone" property="phone" jdbcType="VARCHAR" />
		<result column="sex" property="sex" jdbcType="INTEGER" />
		<result column="email" property="email" jdbcType="VARCHAR" />
		<result column="address" property="address" jdbcType="VARCHAR" />
		<result column="password" property="password" jdbcType="VARCHAR" />
		<result column="use_type" property="useType" jdbcType="INTEGER" />
		<result column="remark1" property="remark1" jdbcType="VARCHAR" />
		<result column="dtflag" property="dtflag" jdbcType="INTEGER" />
		<result column="province" property="province" jdbcType="VARCHAR" />
		<result column="city" property="city" jdbcType="VARCHAR" />
		<result column="country" property="country" jdbcType="VARCHAR" />
		<result column="orderStatu" property="orderStatu" />
		<result column="createTime" property="createTime" />
	</resultMap>
	<sql id="Base_Column_List">
		customer_id, customer_name, customer_identi,
		customer_phone, sex,
		email, address, password,
		use_type, remark1,
		dtflag, province, city,
		country
	</sql>
	<select id="get" resultMap="BaseResultMap" parameterType="java.util.Map">
		<![CDATA[
			SELECT customer.*,o.`order_state` AS 'orderStatu' 
			FROM `app_customer` customer LEFT JOIN `app_orders` o ON customer.`customer_id`=o.`customer_id`
		 ]]>
		<where>
			<if test="queryStr"></if>
		</where>
	</select>

	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		select
		<include refid="Base_Column_List" />
		from app_customer
		where customer_id = #{customerId,jdbcType=VARCHAR}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		update
		app_customer set dtflag=1
		where customer_id =
		#{customerId,jdbcType=VARCHAR}
	</delete>

	<select id="orderInfo" resultType="java.util.HashMap"
		parameterType="String">
		<![CDATA[
			SELECT ao.`order_id`,ao.`order_time`,airport.`airport_name`,suser.`name`,suser.`phone` FROM `app_orders` ao 
			INNER JOIN `sys_airport` airport ON airport.`airport_id`=ao.`airport_id`
			INNER JOIN `sys_users` suser ON suser.`id`=ao.`id` 
			WHERE ao.`customer_id`=#{id}
		 ]]>
	</select>

	<select id="vipCardInfo" resultType="java.util.HashMap"
		parameterType="String">
		<![CDATA[
			SELECT card.`card_no`,card.`valide_time`,card.`remain_money`,card.`init_money` ,ao.`pay_type`,ao.`pay_time`,ao.`activat_time` 
			FROM `app_vipcard` card
			INNER JOIN `app_order_card` aoc ON card.`card_no`=aoc.`card_id`
			INNER JOIN `app_orders` ao ON ao.`order_id`=aoc.`card_id`
			WHERE ao.`customer_id`
		 ]]>
	</select>


	<select id="postInfo" resultType="java.util.HashMap"
		parameterType="String">
		<![CDATA[
			SELECT v.`address`,v.`invoice_type`,v.`invoice_title`,ao.`invoice_flag` FROM `app_invoice`  v 
			INNER JOIN `app_orders` ao ON v.`order_id`=ao.`order_id` 
			WHERE ao.`customer_id`=#{id}
		 ]]>
	</select>

	<select id="backMoneyInfo" resultType="java.util.HashMap"
		parameterType="String">
		<![CDATA[
			SELECT  back.`money`,back.`back_type` FROM `app_card_back` back 
			INNER JOIN `app_vipcard` vip ON back.`card_no`=vip.`card_no` 
			WHERE vip.`customer_id`=#{id}
		 ]]>
	</select>
	<select id="vipCardRescordInfo" resultType="java.util.HashMap"
		parameterType="String">
		<![CDATA[
			SELECT consume.`viproom_name`,consume.`consume_money`,consume.`consume_time` FROM `app_consume` consume 
			INNER JOIN `app_vipcard` vip ON consume.`card_no`=vip.`card_no` 
			WHERE vip.`customer_id`=#{id}
		 ]]>
	</select>
</mapper>